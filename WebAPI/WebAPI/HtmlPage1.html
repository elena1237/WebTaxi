<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" href="https://www.w3schools.com/lib/w3-theme-yellow.css">

    <script src="Scripts/jquery-1.10.2.js"></script>
    <script type="text/javascript">
        $(document).ready(function () {

            let primljeno = localStorage.getItem("logovan");
            let dataP;
            $.ajax({
                type: 'POST',
                url: '/api/Start',
                data: JSON.stringify(primljeno),
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                success: function (data) {
                    dataP = data;
                    if (data != null) {
                        alert('Uspjesno slanje.');
                        if (data.Uloga == 0) {
                            $("#divDispecer").show();
                            $("#divKorisnik").hide();
                            $("#IzmjenaKorisnik1").hide();
                            $("#DodavanjeVozaca").hide();
                            
                        } else if (data.Uloga == 1) {
                            $("#divKorisnik").show();
                            $("#divDispecer").hide();
                            $("#IzmjenaKorisnik").hide();
                            
                           
                        } else {

                        }
                    } else {
                        alert('Neuspjesno slanje.');
                    }
                },
            })





            $("#prikaziKorisnik").click(function () {
                $("#IzmjenaKorisnik").hide();
                $("#PrikazKorisnik").show();
                
                let tableofData = "<table border='1'>";
                    tableofData += `<tr><td>Id</td><td>${dataP.Id}</td></tr>`;
                    tableofData += `<tr><td>Korisnicko ime</td><td>${dataP.KorisnickoIme}</td></tr>`;
                    tableofData += `<tr><td>Lozinka</td><td>${dataP.Lozinka}</td></tr>`;
                    tableofData += `<tr><td>Ime</td><td>${dataP.Ime}</td></tr>`;
                    tableofData += `<tr><td>Prezime</td><td>${dataP.Prezime}</td></tr>`;
                    tableofData += `<tr><td>JMBG</td><td>${dataP.JMBG}</td></tr>`;
                    tableofData += `<tr><td>Kontakt telefon</td><td>${dataP.KontaktTelefon}</td></tr>`;
                    tableofData += `<tr><td>Email</td><td>${dataP.Email}</td></tr>`;
                    tableofData += "</table>";
                    $("#PrikazKorisnik").html(tableofData);
                        
            });

            $("#prikaziKorisnik1").click(function () {
                $("#IzmjenaKorisnik1").hide();
                $("#PrikazKorisnik1").show();
                $("#DodavanjeVozaca").hide();

                let tableofData = "<table border='1'>";
                tableofData += `<tr><td>Id</td><td>${dataP.Id}</td></tr>`;
                tableofData += `<tr><td>Korisnicko ime</td><td>${dataP.KorisnickoIme}</td></tr>`;
                tableofData += `<tr><td>Lozinka</td><td>${dataP.Lozinka}</td></tr>`;
                tableofData += `<tr><td>Ime</td><td>${dataP.Ime}</td></tr>`;
                tableofData += `<tr><td>Prezime</td><td>${dataP.Prezime}</td></tr>`;
                tableofData += `<tr><td>JMBG</td><td>${dataP.JMBG}</td></tr>`;
                tableofData += `<tr><td>Kontakt telefon</td><td>${dataP.KontaktTelefon}</td></tr>`;
                tableofData += `<tr><td>Email</td><td>${dataP.Email}</td></tr>`;
                tableofData += "</table>";
                $("#PrikazKorisnik1").html(tableofData);

            });


            $("#izmjeniKorisnik").click(function () {
                $("#IzmjenaKorisnik").show();
                $("#PrikazKorisnik").hide();

                

                let tableofData = "<table border='1'>";
                tableofData += "<tr><td>Korisnicko ime</td><td><input id=\"korImeReg\" type=\"text\" name=\"KorisnickoIme\" value=\"" + dataP.KorisnickoIme + "\"/></td></tr>";
                tableofData += "<tr><td>Lozinka</td><td><input id=\"korPassReg\" type=\"password\" name=\"Lozinka\" value=\"" + dataP.Lozinka + "\"/></td></tr>";
                tableofData += "<tr><td>Ime</td><td><input id=\"ime\" type=\"text\" name=\"Ime\" value=\"" + dataP.Ime + "\"/></td></tr>";
                tableofData += "<tr><td>Prezime</td><td><input id=\"prezime\" type=\"text\" name=\"Prezime\" value=\"" + dataP.Prezime + "\"/></td></tr>";
                tableofData += "<tr><td>JMBG</td><td><input id=\"jmbg\" type=\"text\" name=\"JMBG\" value=\"" + dataP.JMBG + "\"/></td></tr>";
                tableofData += "<tr><td>Email</td><td><input id=\"email\" type=\"email\" name=\"Email\" value=\"" + dataP.Email + "\"/></td></tr>";
                tableofData += "<tr><td>Kontakt telefon</td><td><input id=\"brTelefona\" type=\"text\" name=\"KontaktTelefon\" value=\"" + dataP.KontaktTelefon + "\"/></td></tr>";
                tableofData += "</table>";
                $("#IzmjenaShow").html(tableofData);

            });

            $("#izmjeniKorisnik1").click(function () {
                $("#IzmjenaKorisnik1").show();
                $("#PrikazKorisnik1").hide();
                $("#DodavanjeVozaca").hide();

                let tableofData = "<table border='1'>";
                tableofData += "<tr><td>Korisnicko ime</td><td><input id=\"korImeReg\" type=\"text\" name=\"KorisnickoIme\" value=\"" + dataP.KorisnickoIme + "\"/></td></tr>";
                tableofData += "<tr><td>Lozinka</td><td><input id=\"korPassReg\" type=\"password\" name=\"Lozinka\" value=\"" + dataP.Lozinka + "\"/></td></tr>";
                tableofData += "<tr><td>Ime</td><td><input id=\"ime\" type=\"text\" name=\"Ime\" value=\"" + dataP.Ime + "\"/></td></tr>";
                tableofData += "<tr><td>Prezime</td><td><input id=\"prezime\" type=\"text\" name=\"Prezime\" value=\"" + dataP.Prezime + "\"/></td></tr>";
                tableofData += "<tr><td>JMBG</td><td><input id=\"jmbg\" type=\"text\" name=\"JMBG\" value=\"" + dataP.JMBG + "\"/></td></tr>";
                tableofData += "<tr><td>Email</td><td><input id=\"email\" type=\"email\" name=\"Email\" value=\"" + dataP.Email + "\"/></td></tr>";
                tableofData += "<tr><td>Kontakt telefon</td><td><input id=\"brTelefona\" type=\"text\" name=\"KontaktTelefon\" value=\"" + dataP.KontaktTelefon + "\"/></td></tr>";
                tableofData += "</table>";
                $("#IzmjenaShow1").html(tableofData);

            });


            $("#potvrdiIzmjenu").click(function () {

                let korisnik = {
                    Id: dataP.Id,
                    KorisnickoIme: `${$('#korImeReg').val()}`,
                    Lozinka: `${$('#korPassReg').val()}`,
                    Ime: `${$('#ime').val()}`,
                    Prezime: `${$('#prezime').val()}`,
                    Pol: dataP.Pol,
                    JMBG: ` ${$('#jmbg').val()}`,
                    Email: `${$('#email').val()}`,
                    KontaktTelefon: `${$('#brTelefona').val()}`,
                    Uloga: dataP.Uloga,
                };
                
                $.ajax({
                    type: 'PUT',
                    url: '/api/Korisnik/' + dataP.Id,
                    data: JSON.stringify(korisnik),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert('Uspjesno izmjenjen korisnik');
                            localStorage.setItem("logovan", korisnik.KorisnickoIme);
                            $(location).attr('href', 'HtmlPage1.html');
                        } else {
                            alert('Ne postoji korisnik kojeg zelite da mijenjate');
                        }
                    },
                })
            });


            $("#potvrdiIzmjenu1").click(function () {

                let korisnik = {
                    Id: dataP.Id,
                    KorisnickoIme: `${$('#korImeReg').val()}`,
                    Lozinka: `${$('#korPassReg').val()}`,
                    Ime: `${$('#ime').val()}`,
                    Prezime: `${$('#prezime').val()}`,
                    Pol: dataP.Pol,
                    JMBG: ` ${$('#jmbg').val()}`,
                    Email: `${$('#email').val()}`,
                    KontaktTelefon: `${$('#brTelefona').val()}`,
                    Uloga: dataP.Uloga,
                };

                $.ajax({
                    type: 'PUT',
                    url: '/api/Korisnik/' + dataP.Id,
                    data: JSON.stringify(korisnik),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert('Uspjesno izmjenjen korisnik');
                            localStorage.setItem("logovan", korisnik.KorisnickoIme);
                            $(location).attr('href', 'HtmlPage1.html');
                        } else {
                            alert('Ne postoji korisnik kojeg zelite da mijenjate');
                        }
                    },
                })
            });


            $("#dodajVozaca").click(function () {
                $("#DodavanjeVozaca").show();
                $("#IzmjenaKorisnik1").hide();
                $("#PrikazKorisnik1").hide();

            });

            $("#dodaj").click(function () {
                $("#DodavanjeVozaca").show();
                $("#IzmjenaKorisnik1").hide();
                $("#PrikazKorisnik1").hide();

                let adresa = {
                    IdAdr: `${$('#idadrese').val()}`,
                    UlicaIBroj: `${$('#ulicaibroj').val()}`,
                    NaseljenoMjesto: `${$('#naseljenomjesto').val()}`,
                    PozivniBroj: `${$('#pozivnibroj').val()}`,
                };

                let lokacija = {
                    IdLok: `${$('#idlokacije').val()}`,
                    X: `${$('#x').val()}`,
                    Y: `${$('#y').val()}`,
                    Adresa: adresa,
                };

            
                let automobil = {
                    Godiste: `${$('#godiste').val()}`,
                    Registracija: `${$('#registracija').val()}`,
                    BrojVozila: `${$('#brojvozila').val()}`,
                    TipAuta: `${$('#tipauta').val()}`,
                };

                let vozac = {
                    KorisnickoIme: `${$('#korImeReg1').val()}`,
                    Lozinka: `${$('#korPassReg1').val()}`,
                    Ime: `${$('#ime1').val()}`,
                    Prezime: `${$('#prezime1').val()}`,
                    Pol: `${$('#pol1').val()}`,
                    JMBG: ` ${$('#jmbg1').val()}`,
                    Email: `${$('#email1').val()}`,
                    KontaktTelefon: `${$('#brTelefona1').val()}`,
                    Lokacija: lokacija,
                    Automobil: automobil,
                };


                $.ajax({
                    type: 'POST',
                    url: '/api/Vozac',
                    data: JSON.stringify(vozac),
                    contentType: 'application/json; charset=utf-8',
                    dataType: 'json',
                    success: function (data) {
                        if (data) {
                            alert('Uspjesno registovan vozac');
                            $(location).attr('href', 'HtmlPage1.html');
                        } else {
                            alert('Vec je registrovan vozac.');
                        }
                    },
                })
            });
        
        });
    </script>

    <style>
       
        #divKorisnik {
            display: none;
        }

        #divDispecer {
            display: none;
        }

       
        body {
            background-image: url("Taxi_Cars_Toys_Back_view_461304.jpg");
            background-repeat:  no-repeat;
            background-position: top;
            background-size: cover;
        }

    </style>

</head>
<body>
    <div class="w3-card-4">
        <div class="w3-container w3-theme w3-card">
            <h1>You are logged in</h1>
        </div>
    </div>
    <div id="divKorisnik">
        <p><b>Wecome user!</b></p>
        <button id="izmjeniKorisnik" type="button"><b>Izmjeni podatke</b></button>
        <button id="prikaziKorisnik" type="button"><b>Prikazi podatke</b></button>
        <div id="PrikazKorisnik"></div>
        <div id="IzmjenaKorisnik">
            <div id="IzmjenaShow">

            </div>
            <button id="potvrdiIzmjenu" type="button"><b>Izmjeni podatke</b></button>
        </div>
    </div>


    <div id="divDispecer">
        <p><b>Wecome dispatcher!</b></p>
        <button id="prikaziKorisnik1" type="button"><b>Prikazi podatke</b></button>
        <button id="izmjeniKorisnik1" type="button"><b>Izmjeni podatke</b></button>
        <button id="dodajVozaca" type="button"><b> Dodaj vozaca </b></button>
        <div id="PrikazKorisnik1"></div>
        <div id="IzmjenaKorisnik1">
            <div id="IzmjenaShow1">

            </div>
            <button id="potvrdiIzmjenu1" type="button"><b>Izmjeni podatke</b></button>
        </div>
        <div id="DodavanjeVozaca">
            
            <table border=1>
                <tr>
                    <td><b>Korisnicko ime</b></td>
                    <td><input id="korImeReg1" type="text" name="KorisnickoIme" /></td>
                </tr>
                <tr>
                    <td><b>Lozinka</b></td>
                    <td><input id="korPassReg1" type="password" name="Lozinka" /></td>
                </tr>

                <tr>
                    <td><b>Ime</b></td>
                    <td><input id="ime1" type="text" name="Ime" /></td>
                </tr>

                <tr>
                    <td><b>Prezime</b></td>
                    <td><input id="prezime1" type="text" name="Prezime" /></td>
                </tr>


                <tr>
                    <td><b>JMBG</b></td>
                    <td><input id="jmbg1" type="text" name="JMBG" /></td>
                </tr>

                <tr>
                    <td><b>Pol</b></td>
                    <td>
                        <select name="Pol1" id="pol">
                            <option>
                                Z
                            </option>
                            <option>
                                M
                            </option>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td><b>Broj telefona</b></td>
                    <td><input id="brTelefona1" type="text" name="KontaktTelefon" /></td>
                </tr>

                <tr>
                    <td><b>Email adresa</b></td>
                    <td><input id="email1" type="email" name="Email" /></td>
                </tr>

                <tr>
                    <td><b>Godiste automobila</b></td>
                    <td><input id="godiste" type="text" name="Godiste" /></td>
                </tr>

                <tr>
                    <td><b>Registracija</b></td>
                    <td><input id="registracija" type="text" name="Registracija" /></td>
                </tr>

                <tr>
                    <td><b>Broj vozila</b></td>
                    <td><input id="brojvozila" type="text" name="BrojVozila" /></td>
                </tr>

                <tr>
                    <td><b>Tip automobila</b></td>
                    <td>
                        <select name="TipAuta" id="tipauta">
                            <option>
                                Kombi
                            </option>
                            <option>
                                Putnicki
                            </option>
                        </select>
                    </td>
                </tr>

                <tr>
                    <td><b>Id lokacije</b></td>
                    <td><input id="idlokacije" type="text" name="IdLok" /></td>
                </tr>

                <tr>
                    <td><b>X koordinata</b></td>
                    <td><input id="x" type="text" name="X" /></td>
                </tr>

                <tr>
                    <td><b>Y koordinata</b></td>
                    <td><input id="y" type="text" name="Y" /></td>
                </tr>

                <tr>
                    <td><b>Id adrese</b></td>
                    <td><input id="idadrese" type="text" name="IdAdr" /></td>
                </tr>

                <tr>
                    <td><b>Ulica i broj</b></td>
                    <td><input id="ulicaibroj" type="text" name="UlicaIBroj" /></td>
                </tr>

                <tr>
                    <td><b>Naseljeno mjesto</b></td>
                    <td><input id="naseljenomjesto" type="text" name="NaseljenoMjesto" /></td>
                </tr>

                <tr>
                    <td><b>Pozivni broj mjesta</b></td>
                    <td><input id="pozivnibroj" type="text" name="PozivniBroj" /></td>
                </tr>


            </table>
            <button id="dodaj" type="button"><b>Dodaj</b></button>

        </div>
    </div>

</body>
</html>
